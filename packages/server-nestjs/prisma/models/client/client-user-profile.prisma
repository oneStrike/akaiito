/// 用户详细配置表
model ClientUserProfile {
  /// 主键ID
  id       String @id @default(cuid()) @map("id")
  /// 关联用户ID
  userId   String @unique @map("user_id")
  /// 关联用户
  user     ClientUser @relation(fields: [userId], references: [id], onDelete: Cascade)

  // === 兴趣爱好标签 ===
  /// 兴趣标签（JSON数组）
  interests    Json?   @map("interests")
  /// 技能标签（JSON数组）
  skills       Json?   @map("skills")

  // === 应用偏好设置 ===
  /// 主题偏好（light/dark/auto）
  themePreference String @default("auto") @map("theme_preference") @db.VarChar(10)
  /// 字体大小偏好
  fontSize     String @default("medium") @map("font_size") @db.VarChar(10)
  /// 是否启用动画效果
  animationEnabled Boolean @default(true) @map("animation_enabled")
  /// 是否启用声音效果
  soundEnabled Boolean @default(true) @map("sound_enabled")

  // === 隐私设置 ===
  /// 是否显示在线状态
  showOnlineStatus Boolean @default(true) @map("show_online_status")
  /// 是否允许陌生人私信
  allowStrangerMessage Boolean @default(true) @map("allow_stranger_message")
  /// 是否公开生日
  showBirthday Boolean @default(false) @map("show_birthday")
  /// 是否公开年龄
  showAge      Boolean @default(false) @map("show_age")
  /// 是否公开地理位置
  showLocation Boolean @default(false) @map("show_location")

  // === 安全设置 ===
  /// 是否启用登录地点验证
  locationVerification Boolean @default(false) @map("location_verification")
  /// 是否启用设备验证
  deviceVerification Boolean @default(false) @map("device_verification")
  /// 密码最后修改时间
  passwordChangedAt DateTime? @map("password_changed_at") @db.Timestamptz

  // === 时间戳 ===
  /// 创建时间
  createdAt    DateTime @default(now()) @map("created_at") @db.Timestamptz
  /// 更新时间
  updatedAt    DateTime @updatedAt @map("updated_at") @db.Timestamptz

  @@index([userId]) // 用户ID索引
  @@map("client_user_profile")
}

/// 用户登录历史表
model ClientUserLoginHistory {
  /// 主键ID
  id          String @id @default(cuid()) @map("id")
  /// 关联用户ID
  userId      String @map("user_id")
  /// 关联用户
  user        ClientUser @relation(fields: [userId], references: [id], onDelete: Cascade)

  // === 登录信息 ===
  /// 登录IP地址
  ipAddress   String @map("ip_address") @db.VarChar(45)
  /// 登录设备信息
  deviceInfo  String? @map("device_info") @db.VarChar(500)
  /// 用户代理字符串
  userAgent   String? @map("user_agent") @db.Text
  /// 登录地理位置
  location    String? @map("location") @db.VarChar(255)
  /// 登录方式（password/sms/email/oauth）
  loginMethod String @map("login_method") @db.VarChar(20)
  /// 是否登录成功
  isSuccess   Boolean @map("is_success")
  /// 失败原因
  failReason  String? @map("fail_reason") @db.VarChar(255)
  /// 登出时间
  logoutAt    DateTime? @map("logout_at") @db.Timestamptz

  // === 风险评估 ===
  /// 风险等级（low/medium/high）
  riskLevel   String? @map("risk_level") @db.VarChar(10)
  /// 是否为可疑登录
  isSuspicious Boolean @default(false) @map("is_suspicious")
  /// 是否需要额外验证
  needsVerification Boolean @default(false) @map("needs_verification")

  // === 时间戳 ===
  /// 登录时间
  loginAt     DateTime @default(now()) @map("login_at") @db.Timestamptz

  @@index([userId, loginAt]) // 用户登录历史查询
  @@index([ipAddress]) // IP地址查询
  @@index([isSuccess, loginAt]) // 登录成功率统计
  @@index([isSuspicious]) // 可疑登录查询
  @@index([riskLevel, loginAt]) // 风险等级分析
  @@map("client_user_login_history")
}

/// 用户设备管理表
model ClientUserDevice {
  /// 主键ID
  id          String @id @default(cuid()) @map("id")
  /// 关联用户ID
  userId      String @map("user_id")
  /// 关联用户
  user        ClientUser @relation(fields: [userId], references: [id], onDelete: Cascade)

  // === 设备信息 ===
  /// 设备唯一标识
  deviceId    String @unique @map("device_id") @db.VarChar(128)
  /// 设备名称
  deviceName  String @map("device_name") @db.VarChar(100)
  /// 设备类型（mobile/tablet/desktop/tv）
  deviceType  String @map("device_type") @db.VarChar(20)
  /// 操作系统
  osName      String? @map("os_name") @db.VarChar(50)
  /// 操作系统版本
  osVersion   String? @map("os_version") @db.VarChar(50)

  // === 设备状态 ===
  /// 是否为受信任设备
  isTrusted   Boolean @default(false) @map("is_trusted")
  /// 是否当前活跃
  isActive    Boolean @default(true) @map("is_active")
  /// 推送令牌
  pushToken   String? @map("push_token") @db.VarChar(255)
  
  // === 时间戳 ===
  /// 首次登录时间
  firstLoginAt DateTime @default(now()) @map("first_login_at") @db.Timestamptz
  /// 最后登录时间
  lastLoginAt DateTime @default(now()) @map("last_login_at") @db.Timestamptz
  /// 创建时间
  createdAt   DateTime @default(now()) @map("created_at") @db.Timestamptz
  /// 更新时间
  updatedAt   DateTime @updatedAt @map("updated_at") @db.Timestamptz

  @@index([userId, isActive]) // 用户活跃设备查询
  @@index([deviceId]) // 设备ID查询
  @@index([isTrusted]) // 受信任设备查询
  @@index([lastLoginAt]) // 最后登录时间排序
  @@map("client_user_device")
}
